<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Macartan Humphreys">

<title>10 choses Ã  savoir sur lâ€™infÃ©rence causale â€“ Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/egap-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides.html"> 
<span class="menu-text">Methods guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">10 choses Ã  savoir sur lâ€™infÃ©rence causale</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10 choses Ã  savoir sur lâ€™infÃ©rence causale</h1>
</div>

<div class="quarto-title-meta">
    
    
    
    
</div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Summary</div>
    <p>Le philosophe David Lewis a dÃ©crit la causalitÃ© comme â€œquelque chose qui fait une diffÃ©rence, et cette diffÃ©rence doit Ãªtre une diffÃ©rence par rapport Ã  ce qui se serait passÃ© sans elleâ€ <span class="citation" data-cites="david">[@david]</span>. Ceci est lâ€™interprÃ©tation de la causalitÃ© pour la plupart des expÃ©rimentalistes. MÃªme si la dÃ©finition semble simple, elle a de nombreuses implications subtiles. Voici dix idÃ©es impliquÃ©es par cette notion de causalitÃ© qui importent pour la conception de recherche.</p>
  </div>
</div>
</header>

<nav id="TOC" role="doc-toc">
    <h4 id="toc-title">Contents</h4>
   
  <ul>
  <li><a href="#rÃ©sumÃ©" id="toc-rÃ©sumÃ©"><span class="header-section-number">1</span> RÃ©sumÃ©</a></li>
  <li><a href="#une-assertion-causale-est-une-dÃ©claration-sur-ce-qui-ne-sest-pas-produit." id="toc-une-assertion-causale-est-une-dÃ©claration-sur-ce-qui-ne-sest-pas-produit."><span class="header-section-number">2</span> Une assertion causale est une dÃ©claration sur ce qui ne sâ€™est pas produit.</a></li>
  <li><a href="#pas-de-causalitÃ©-sans-manipulation." id="toc-pas-de-causalitÃ©-sans-manipulation."><span class="header-section-number">3</span> Pas de causalitÃ© sans manipulation.</a></li>
  <li><a href="#les-causes-sont-non-rivales." id="toc-les-causes-sont-non-rivales."><span class="header-section-number">4</span> Les causes sont non rivales.</a></li>
  <li><a href="#x-peut-causer-y-mÃªme-si-x-nest-pas-une-condition-nÃ©cessaire-ou-une-condition-suffisante-pour-y." id="toc-x-peut-causer-y-mÃªme-si-x-nest-pas-une-condition-nÃ©cessaire-ou-une-condition-suffisante-pour-y."><span class="header-section-number">5</span> <span class="math inline">\(X\)</span> peut causer <span class="math inline">\(Y\)</span> mÃªme si <span class="math inline">\(X\)</span> nâ€™est pas une condition nÃ©cessaire ou une condition suffisante pour <span class="math inline">\(Y\)</span>.</a></li>
  <li><a href="#le-problÃ¨me-fondamental-de-linfÃ©rence-causale." id="toc-le-problÃ¨me-fondamental-de-linfÃ©rence-causale."><span class="header-section-number">6</span> Le problÃ¨me fondamental de lâ€™infÃ©rence causale.</a></li>
  <li><a href="#vous-pouvez-estimer-leffet-causal-moyen-mÃªme-si-vous-ne-pouvez-observer-aucun-effet-causal-individuel." id="toc-vous-pouvez-estimer-leffet-causal-moyen-mÃªme-si-vous-ne-pouvez-observer-aucun-effet-causal-individuel."><span class="header-section-number">7</span> Vous pouvez estimer lâ€™effet causal moyen mÃªme si vous ne pouvez observer aucun effet causal individuel.</a></li>
  <li><a href="#lestimation-de-leffet-causal-moyen-ne-nÃ©cessite-pas-que-les-groupes-de-traitement-et-de-contrÃ´le-soient-identiques." id="toc-lestimation-de-leffet-causal-moyen-ne-nÃ©cessite-pas-que-les-groupes-de-traitement-et-de-contrÃ´le-soient-identiques."><span class="header-section-number">8</span> Lâ€™estimation de lâ€™effet causal moyen ne nÃ©cessite pas que les groupes de traitement et de contrÃ´le soient identiques.</a></li>
  <li><a href="#la-corrÃ©lation-nest-pas-la-causalitÃ©." id="toc-la-corrÃ©lation-nest-pas-la-causalitÃ©."><span class="header-section-number">9</span> La corrÃ©lation nâ€™est pas la causalitÃ©.</a></li>
  <li><a href="#si-vous-savez-quen-moyenne-a-cause-b-et-b-cause-c-cela-ne-veut-pas-dire-quen-moyenne-a-cause-c." id="toc-si-vous-savez-quen-moyenne-a-cause-b-et-b-cause-c-cela-ne-veut-pas-dire-quen-moyenne-a-cause-c."><span class="header-section-number">10</span> Si vous savez quâ€™en moyenne <span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span> et <span class="math inline">\(B\)</span> cause <span class="math inline">\(C\)</span>, cela ne veut pas dire quâ€™en moyenne <span class="math inline">\(A\)</span> cause <span class="math inline">\(C\)</span>.</a></li>
  <li><a href="#il-est-plus-facile-den-apprendre-davantage-sur-les-effets-des-causes-que-sur-les-causes-des-effets." id="toc-il-est-plus-facile-den-apprendre-davantage-sur-les-effets-des-causes-que-sur-les-causes-des-effets."><span class="header-section-number">11</span> Il est plus facile dâ€™en apprendre davantage sur les â€œeffets des causesâ€ que sur les â€œcauses des effetsâ€.</a></li>
  </ul>
</nav>
<section id="rÃ©sumÃ©" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> RÃ©sumÃ©</h1>
</section>
<section id="une-assertion-causale-est-une-dÃ©claration-sur-ce-qui-ne-sest-pas-produit." class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Une assertion causale est une dÃ©claration sur ce qui ne sâ€™est pas produit.</h1>
<p>Pour la plupart des expÃ©rimentalistes, la dÃ©claration â€œ<span class="math inline">\(X\)</span> a causÃ© <span class="math inline">\(Y\)</span>â€ signifie que <span class="math inline">\(Y\)</span> est prÃ©sent <em>et</em> <span class="math inline">\(Y\)</span> nâ€™aurait pas Ã©tÃ© prÃ©sent si <span class="math inline">\(X\)</span> nâ€™avait pas Ã©tÃ© prÃ©sent. Cette dÃ©finition requiert une notion de ce qui aurait pu arriver, mais ne sâ€™est pas produit.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> De mÃªme, â€œlâ€™effetâ€ de <span class="math inline">\(X\)</span> sur <span class="math inline">\(Y\)</span> est la diffÃ©rence entre la valeur que <span class="math inline">\(Y\)</span> aurait prise Ã©tant donnÃ© une valeur de <span class="math inline">\(X\)</span> et la valeur que <span class="math inline">\(Y\)</span> aurait prise Ã©tant donnÃ© une autre valeur de <span class="math inline">\(X\)</span>. En raison de lâ€™accent mis sur les diffÃ©rences entre les rÃ©sultats, cette approche est parfois appelÃ©e approche â€œdes diffÃ©rencesâ€ ou â€œcontrefactuelleâ€ de la causalitÃ©.</p>
<p><strong>Note technique:</strong> Les statisticiens emploient le cadre des â€œrÃ©sultats potentielsâ€ pour dÃ©crire les relations contrefactuelles. Dans ce cadre, <span class="math inline">\(Y_i(1)\)</span> dÃ©signe le rÃ©sultat pour lâ€™unitÃ© <span class="math inline">\(i\)</span> qui serait observÃ© sous une condition (par exemple, si lâ€™unitÃ© <span class="math inline">\(i\)</span> a reÃ§u un traitement) et <span class="math inline">\(Y_i(0)\)</span> dÃ©signe le rÃ©sultat qui serait observÃ© dans une autre condition (par exemple, si lâ€™unitÃ© <span class="math inline">\(i\)</span> nâ€™a pas reÃ§u le traitement). Un effet causal du traitement pour lâ€™unitÃ© <span class="math inline">\(i\)</span> pourrait Ãªtre une simple diffÃ©rence des rÃ©sultats potentiels <span class="math inline">\(Ï„_i=Y_i(1)âˆ’Y_i(0)\)</span>. Un traitement a un effet causal (positif ou nÃ©gatif) sur <span class="math inline">\(Y\)</span> pour lâ€™unitÃ© <span class="math inline">\(i\)</span> si <span class="math inline">\(Y_i(1)â‰ Y_i(0)\)</span>.</p>
</section>
<section id="pas-de-causalitÃ©-sans-manipulation." class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Pas de causalitÃ© sans manipulation.</h1>
<p>La dÃ©finition â€œcontrefactuelleâ€ de la causalitÃ© exige que lâ€™on soit capable de rÃ©flÃ©chir aux rÃ©sultats qui peuvent entraÃ®ner des conditions diffÃ©rentes. Quelle serait la situation si un parti plutÃ´t quâ€™un autre Ã©tait Ã©lu ? Les dÃ©clarations causales de tous les jours ne rÃ©pondent souvent pas Ã  cette exigence de lâ€™une des deux maniÃ¨res suivantes.</p>
<ul>
<li><p>PremiÃ¨rement, certaines dÃ©clarations ne prÃ©cisent pas de conditions contrefactuelles claires. Par exemple, lâ€™affirmation selon laquelle â€œla rÃ©cession a Ã©tÃ© causÃ©e par Wall Streetâ€ nâ€™indique pas de contrefactuel Ã©vident â€” devons-nous examiner sâ€™il y aurait eu une rÃ©cession si Wall Street nâ€™avait pas existÃ© ? Ou est-ce une dÃ©claration sur des dÃ©cisions particuliÃ¨res que Wall Street aurait pu prendre mais nâ€™a pas prises ? Si oui, quelles dÃ©cisions ? La validitÃ© de telles dÃ©clarations est difficile Ã  Ã©valuer et peut dÃ©pendre des conditions contrefactuelles impliquÃ©es par une dÃ©claration.</p></li>
<li><p>DeuxiÃ¨mement, certaines dÃ©clarations impliquent des conditions contrefactuelles qui ne peuvent Ãªtre imaginÃ©es. Par exemple, lâ€™affirmation selon laquelle Peter a obtenu le poste parce quâ€™il est Peter implique une considÃ©ration de ce qui se serait passÃ© si Peter nâ€™Ã©tait pas Peter. Alternativement, lâ€™affirmation selon laquelle Peter a obtenu le poste parce quâ€™il est un homme nÃ©cessite de considÃ©rer Peter comme autre quâ€™un homme. Le problÃ¨me est que les contrefactuels dans ces cas impliquent un changement non seulement de la condition Ã  laquelle fait face un individu, mais de lâ€™individu lui-mÃªme.</p></li>
</ul>
<p>Pour Ã©viter de tels problÃ¨mes, certains statisticiens recommandent de restreindre les assertions causales aux traitements qui peuvent en thÃ©orie (pas nÃ©cessairement en pratique) Ãªtre manipulÃ©s.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Par exemple, alors que nous pourrions avoir des difficultÃ©s avec lâ€™affirmation selon laquelle Peter a obtenu le poste parce quâ€™il Ã©tait un homme, nous nâ€™avons pas de telles difficultÃ©s avec lâ€™affirmation selon laquelle Peter a obtenu le poste parce que lâ€™agence de recrutement pensait quâ€™il Ã©tait un homme.</p>
</section>
<section id="les-causes-sont-non-rivales." class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Les causes sont non rivales.</h1>
<p>MÃªme si nous pouvons nous concentrer sur lâ€™effet dâ€™une seule cause <span class="math inline">\(X\)</span> sur un rÃ©sultat <span class="math inline">\(Y\)</span>, nous ne nous attendons gÃ©nÃ©ralement pas Ã  ce quâ€™il nâ€™y ait quâ€™une seule cause de <span class="math inline">\(Y\)</span>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> De plus, si vous additionnez les effets causaux de diffÃ©rentes causes, il nâ€™y a aucune raison de sâ€™attendre Ã  ce quâ€™ils totalisent 100 %. Par consÃ©quent, il ne sert Ã  rien dâ€™essayer de â€œrÃ©partirâ€ les rÃ©sultats entre diffÃ©rents facteurs de causalitÃ©. En dâ€™autres termes, les causes sont non rivales. La National Rifle Association soutient, par exemple, que les armes Ã  feu ne tuent pas les gens, les gens tuent les gens. Cette dÃ©claration nâ€™a pas beaucoup de sens dans le cadre contrefactuel. Enlevez les armes Ã  feu et vous nâ€™aurez pas de morts par balles. Les armes Ã  feu sont donc une cause. Enlevez les gens et vous nâ€™aurez pas non plus de dÃ©cÃ¨s par balle, donc les gens sont aussi une cause. En dâ€™autres termes, ces deux facteurs sont simultanÃ©ment les causes des mÃªmes rÃ©sultats.</p>
</section>
<section id="x-peut-causer-y-mÃªme-si-x-nest-pas-une-condition-nÃ©cessaire-ou-une-condition-suffisante-pour-y." class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> <span class="math inline">\(X\)</span> peut causer <span class="math inline">\(Y\)</span> mÃªme si <span class="math inline">\(X\)</span> nâ€™est pas une condition nÃ©cessaire ou une condition suffisante pour <span class="math inline">\(Y\)</span>.</h1>
<p>On parle souvent des relations causales en termes dÃ©terministes. MÃªme la citation de Lewis en haut de cette page semble suggÃ©rer une relation dÃ©terministe entre les causes et les effets. On pense parfois que les relations causales impliquent des conditions nÃ©cessaires (pour que <span class="math inline">\(Y\)</span> se produise, <span class="math inline">\(X\)</span> doit se produire); on pense parfois que de telles relations impliquent des conditions suffisantes (si <span class="math inline">\(X\)</span> se produit, alors <span class="math inline">\(Y\)</span> se produit). Mais une fois que nous parlons dâ€™unitÃ©s multiples, il y a au moins deux faÃ§ons de penser que <span class="math inline">\(X\)</span> cause <span class="math inline">\(Y\)</span> mÃªme si <span class="math inline">\(X\)</span> nâ€™est ni une condition nÃ©cessaire ni une condition suffisante pour <span class="math inline">\(Y\)</span>. La premiÃ¨re consiste Ã  tout rÃ©interprÃ©ter en termes probabilistes : par <span class="math inline">\(X\)</span> cause <span class="math inline">\(Y\)</span>, on entend simplement que la probabilitÃ© de <span class="math inline">\(Y\)</span> est plus Ã©levÃ©e lorsque <span class="math inline">\(X\)</span> est prÃ©sent. Une autre consiste Ã  tenir compte des contingences â€” par exemple, <span class="math inline">\(X\)</span> peut causer <span class="math inline">\(Y\)</span> si la condition <span class="math inline">\(Z\)</span> est prÃ©sente, mais pas dans le cas contraire.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</section>
<section id="le-problÃ¨me-fondamental-de-linfÃ©rence-causale." class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Le problÃ¨me fondamental de lâ€™infÃ©rence causale.</h1>
<p>Si les effets causaux sont des dÃ©clarations sur la diffÃ©rence entre ce qui sâ€™est produit et ce qui aurait pu se produire, alors les effets causaux ne peuvent pas Ãªtre mesurÃ©s. Mauvaise nouvelle ! De maniÃ¨re prospective, vous pouvez organiser les choses de maniÃ¨re Ã  observer ce qui se passe si une personne reÃ§oit un traitement ou ce qui se passe si elle ne reÃ§oit pas le traitement. Pourtant, pour la mÃªme personne, vous ne pourrez jamais observer ces deux rÃ©sultats et leur diffÃ©rence. Cette incapacitÃ© Ã  observer les effets causaux au niveau de lâ€™unitÃ© est souvent appelÃ©e le â€œproblÃ¨me fondamental de lâ€™infÃ©rence causaleâ€.</p>
</section>
<section id="vous-pouvez-estimer-leffet-causal-moyen-mÃªme-si-vous-ne-pouvez-observer-aucun-effet-causal-individuel." class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Vous pouvez estimer lâ€™effet causal moyen mÃªme si vous ne pouvez observer aucun effet causal individuel.</h1>
<p>MÃªme si vous ne pouvez pas observer si <span class="math inline">\(X\)</span> cause <span class="math inline">\(Y\)</span> pour une unitÃ© donnÃ©e, il est peut-Ãªtre toujours possible de dÃ©terminer si <span class="math inline">\(X\)</span> cause <span class="math inline">\(Y\)</span> en moyenne. Lâ€™effet causal moyen est Ã©gal Ã  la diffÃ©rence entre le rÃ©sultat moyen pour toutes les unitÃ©s si elles Ã©taient toutes dans la condition de contrÃ´le et le rÃ©sultat moyen pour toutes les unitÃ©s si elles Ã©taient toutes dans la condition de traitement. De nombreuses stratÃ©gies dâ€™identification causale (voir <a href="http://egap.org/resource/10-strategies-for-figuring-out-if-x-caused-y">10 stratÃ©gies pour dÃ©terminer si X a causÃ© Y</a>) se concentrent sur des faÃ§ons dâ€™en savoir plus sur ces rÃ©sultats potentiels moyens.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p><a href="https://egap.org/resource/10-things-to-know-about-hypothesis-testing/">10 choses Ã  savoir sur les tests dâ€™hypothÃ¨se</a> dÃ©crit comment en savoir plus sur les effets causaux individuels plutÃ´t que sur les effets causaux moyens Ã©tant donnÃ© le problÃ¨me fondamental de lâ€™infÃ©rence causale.</p>
</section>
<section id="lestimation-de-leffet-causal-moyen-ne-nÃ©cessite-pas-que-les-groupes-de-traitement-et-de-contrÃ´le-soient-identiques." class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Lâ€™estimation de lâ€™effet causal moyen ne nÃ©cessite pas que les groupes de traitement et de contrÃ´le soient identiques.</h1>
<p>Une stratÃ©gie que les gens utilisent pour en savoir plus sur lâ€™effet causal moyen consiste Ã  crÃ©er des groupes de traitement et de contrÃ´le par randomisation (voir <a href="http://egap.org/resource/10-strategies-for-figuring-out-if-x-caused-y">10 StratÃ©gies pour dÃ©terminer si X a causÃ© Y</a>). Ce faisant, les chercheurs sâ€™inquiÃ¨tent parfois sâ€™ils constatent que les groupes de traitement et de contrÃ´le qui en rÃ©sultent ne sont pas comparables sur certaines dimensions importantes.</p>
<p>La bonne nouvelle est que lâ€™argument expliquant pourquoi les diffÃ©rences dans les rÃ©sultats moyens entre les groupes de traitement et de contrÃ´le assignÃ©s de maniÃ¨re alÃ©atoire capturent lâ€™effet moyen du traitement (en espÃ©rance pour des randomisations rÃ©pÃ©tÃ©es au sein du mÃªme groupe dâ€™unitÃ©s) ne repose <em>pas</em> sur le fait que les groupes de traitement et de contrÃ´le ont des caractÃ©ristiques observÃ©es similaires. Il repose uniquement sur lâ€™idÃ©e que, en moyenne, les rÃ©sultats dans les groupes de traitement et de contrÃ´le captureront les rÃ©sultats moyens pour toutes les unitÃ©s du groupe expÃ©rimental si elles Ã©taient, respectivement, dans le traitement ou dans le contrÃ´le. En pratique, les groupes de traitement et de contrÃ´le rÃ©els ne seront pas identiques.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
</section>
<section id="la-corrÃ©lation-nest-pas-la-causalitÃ©." class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> La corrÃ©lation nâ€™est pas la causalitÃ©.</h1>
<p>Une corrÃ©lation entre <span class="math inline">\(X\)</span> et <span class="math inline">\(Y\)</span> est une dÃ©claration sur les relations entre les rÃ©sultats rÃ©els, et non sur la relation entre les rÃ©sultats rÃ©els et les rÃ©sultats contrefactuels. Ainsi, les dÃ©clarations sur les causes et les corrÃ©lations nâ€™ont pas grand-chose Ã  voir les unes avec les autres. Des corrÃ©lations positives peuvent Ãªtre cohÃ©rentes avec des effets causaux positifs, aucun effet causal ou mÃªme des effets causaux nÃ©gatifs. Par exemple, la prise de mÃ©dicaments contre la toux est positivement corrÃ©lÃ©e Ã  la toux mais a, espÃ©rons-le, un effet causal nÃ©gatif sur la toux.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</section>
<section id="si-vous-savez-quen-moyenne-a-cause-b-et-b-cause-c-cela-ne-veut-pas-dire-quen-moyenne-a-cause-c." class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Si vous savez quâ€™en moyenne <span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span> et <span class="math inline">\(B\)</span> cause <span class="math inline">\(C\)</span>, cela ne veut pas dire quâ€™en moyenne <span class="math inline">\(A\)</span> cause <span class="math inline">\(C\)</span>.</h1>
<p>Vous pourriez vous attendre Ã  ce que si <span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span> et <span class="math inline">\(B\)</span> cause <span class="math inline">\(C\)</span>, alors <span class="math inline">\(A\)</span> cause <span class="math inline">\(C\)</span>.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> Mais il nâ€™y a aucune raison que les relations causales moyennes soient transitives. Imaginez que <span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span> pour les hommes mais pas les femmes et <span class="math inline">\(B\)</span> cause <span class="math inline">\(C\)</span> pour les femmes mais pas les hommes. Ensuite, en moyenne, <span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span> et <span class="math inline">\(B\)</span> cause <span class="math inline">\(C\)</span>, mais <span class="math inline">\(A\)</span> ne cause pas <span class="math inline">\(C\)</span> Ã  travers <span class="math inline">\(B\)</span>.</p>
</section>
<section id="il-est-plus-facile-den-apprendre-davantage-sur-les-effets-des-causes-que-sur-les-causes-des-effets." class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Il est plus facile dâ€™en apprendre davantage sur les â€œeffets des causesâ€ que sur les â€œcauses des effetsâ€.</h1>
<p>Bien que cela puisse sembler Ãªtre deux faÃ§ons de dire la mÃªme chose, il y a une diffÃ©rence entre comprendre quel est lâ€™effet de <span class="math inline">\(X\)</span> sur <span class="math inline">\(Y\)</span> (les â€œeffets dâ€™une causeâ€) et si un rÃ©sultat <span class="math inline">\(Y\)</span> Ã©tait <em>dÃ»</em> Ã  une cause <span class="math inline">\(X\)</span> (la â€œcause dâ€™un effetâ€).<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> ConsidÃ©rez lâ€™exemple suivant. Supposons que nous menions une expÃ©rience avec un Ã©chantillon qui contient un nombre Ã©gal dâ€™hommes et de femmes. Lâ€™expÃ©rience assigne de maniÃ¨re alÃ©atoire des hommes et des femmes Ã  un traitement binaire <span class="math inline">\(X\)</span> et mesure un rÃ©sultat binaire <span class="math inline">\(Y\)</span>. De plus, supposons que <span class="math inline">\(X\)</span> ait un effet positif de 1 pour tous les hommes, câ€™est-Ã -dire le rÃ©sultat potentiel de contrÃ´le des hommes est de zÃ©ro, <span class="math inline">\(Y_i(0) = 0\)</span>, et leur rÃ©sultat potentiel traitÃ© est de un, <span class="math inline">\(Y_i(1) = 1\)</span>. Pour toutes les femmes, <span class="math inline">\(X\)</span> a un effet nÃ©gatif de <span class="math inline">\(-1\)</span>, câ€™est-Ã -dire que le rÃ©sultat potentiel de contrÃ´le des femmes est de un, <span class="math inline">\(Y_i(0) = 1\)</span>, et leur rÃ©sultat potentiel traitÃ© est de zÃ©ro, <span class="math inline">\(Y_i(1) = 0\)</span>. Dans cet exemple, lâ€™effet moyen de <span class="math inline">\(X\)</span> sur <span class="math inline">\(Y\)</span> est nul. Mais pour tous les participants du groupe de traitement avec <span class="math inline">\(Y=1\)</span>, il est vrai que <span class="math inline">\(Y=1\)</span> <em>car</em> <span class="math inline">\(X=1\)</span>. De mÃªme, pour tous les participants du groupe de traitement avec <span class="math inline">\(Y=0\)</span>, il est vrai que <span class="math inline">\(Y=0\)</span> <em>car</em> <span class="math inline">\(X=1\)</span>. Lâ€™expÃ©rimentation peut obtenir une rÃ©ponse exacte Ã  la question sur les â€œeffets dâ€™une causeâ€, mais il nâ€™est gÃ©nÃ©ralement pas possible dâ€™obtenir une rÃ©ponse exacte Ã  la question sur la â€œcause dâ€™un effetâ€.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Holland, Paul W. â€œStatistics and causal inference.â€ Journal of the American Statistical Association 81.396 (1986): 945-960.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>Holland, Paul W. â€œStatistics and causal inference.â€ Journal of the American Statistical Association 81.396 (1986): 945-960.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3"><p>Certains appellent cela le â€œproblÃ¨me des causes de prodigalitÃ©â€.<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn4"><p>Mackie a prÃ©sentÃ© lâ€™idÃ©e de conditions dites â€œINSSâ€ (â€œINUSâ€ en anglais) pour capturer la dÃ©pendance des causes sur dâ€™autres causes. Une cause peut Ãªtre une partie <em>Insuffisante</em> mais <em>NÃ©cessaire</em> dâ€™une condition qui est elle-mÃªme <em>Superflue</em> mais <em>Suffisante</em>. Par exemple, composer un numÃ©ro de tÃ©lÃ©phone est une cause de â€œcontacter quelquâ€™unâ€ car avoir une connexion et composer un numÃ©ro est suffisant (S) pour passer un appel tÃ©lÃ©phonique, alors que composer seul sans connexion ne suffirait pas (I), ni avoir un connexion (N). Il existe bien sÃ»r dâ€™autres moyens de contacter quelquâ€™un sans passer dâ€™appels tÃ©lÃ©phoniques (S). Mackie, John L. â€œThe cement of the universe.â€ London: Oxford Uni (1974).<a href="#fnref4" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn5"><p><strong>Note technique :</strong> La principale idÃ©e technique est que la diffÃ©rence des moyennes est la mÃªme que la moyenne des diffÃ©rences. Câ€™est-Ã -dire, en utilisant â€œlâ€™opÃ©rateur dâ€™espÃ©ranceâ€, <span class="math inline">\(ğ”¼(Ï„_i)=ğ”¼(Y_i(1)âˆ’Y_i(0))=ğ”¼(Y_i(1))âˆ’ğ”¼(Y_i(0))\)</span>. Les termes Ã  lâ€™intÃ©rieur de lâ€™opÃ©rateur dâ€™espÃ©rance dans la deuxiÃ¨me quantitÃ© ne peuvent pas Ãªtre estimÃ©s, mais les termes Ã  lâ€™intÃ©rieur de lâ€™opÃ©rateur dâ€™espÃ©rance dans la troisiÃ¨me quantitÃ© peuvent lâ€™Ãªtre.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>Voir lâ€™illustration <a href="https://raw.githubusercontent.com/egap/%20methodes-guides/master/causal-inference/PO.jpg">ici</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn6"><p>Pour cette raison, les tests-<span class="math inline">\(t\)</span> pour vÃ©rifier si â€œla randomisation a fonctionnÃ©â€ nâ€™ont pas beaucoup de sens, du moins si vous savez quâ€™une procÃ©dure randomisÃ©e a Ã©tÃ© suivie â€” simplement par hasard, 1 test sur 20 montrera des diffÃ©rences statistiquement dÃ©tectables entre les groupes de traitement et de contrÃ´le. En cas de doute sur la mise en Å“uvre correcte dâ€™une procÃ©dure randomisÃ©e, ces tests peuvent Ãªtre utilisÃ©s pour tester lâ€™hypothÃ¨se selon laquelle les donnÃ©es ont bien Ã©tÃ© gÃ©nÃ©rÃ©es par une procÃ©dure randomisÃ©e. Ces tests peuvent alors Ãªtre particuliÃ¨rement importants pour des expÃ©riences de terrain oÃ¹ les chaÃ®nes de communication entre la personne randomisant et la personne mettant en Å“uvre lâ€™assignation du traitement peuvent Ãªtre longues et complexes.<a href="#fnref6" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn7"><p><strong>Note technique</strong>: soit <span class="math inline">\(D_i\)</span> un indicateur pour savoir si lâ€™unitÃ© <span class="math inline">\(i\)</span> a reÃ§u un traitement ou non. Alors, la diffÃ©rence des rÃ©sultats moyens entre ceux qui reÃ§oivent le traitement et ceux qui ne le reÃ§oivent pas peut sâ€™Ã©crire <span class="math inline">\(\frac{âˆ‘_i D_iÃ—Y_i(1)}{âˆ‘_iD_i}âˆ’\frac{âˆ‘_i (1âˆ’D_i)Ã— Y_i(0)}{âˆ‘_i (1âˆ’D_i)}\)</span>. En lâ€™absence dâ€™informations sur la maniÃ¨re dont le traitement a Ã©tÃ© assignÃ©, nous ne pouvons pas dire si cette diffÃ©rence est un bon estimateur de lâ€™effet moyen du traitement, câ€™est-Ã -dire de la diffÃ©rence entre les rÃ©sultats potentiels moyens pour les groupes de traitement et de contrÃ´le pour toutes les unitÃ©s. Ce qui importe est de savoir si <span class="math inline">\(\frac{âˆ‘_i D_iÃ—Y_i(1)}{âˆ‘_iD_i}\)</span> est une bonne estimation de <span class="math inline">\(\frac{âˆ‘_i 1Ã—Y_i(1)}{âˆ‘_i1}\)</span> et si <span class="math inline">\(\frac {âˆ‘_i (1âˆ’D_i)Ã—Y_i(0)}{âˆ‘_i (1âˆ’D_i)}\)</span> est une bonne estimation de <span class="math inline">\(\frac{âˆ‘_i 1Ã—Y_i(0)}{âˆ‘_i1}\)</span>. Cela pourrait Ãªtre le cas si ceux qui ont reÃ§u un traitement sont un Ã©chantillon reprÃ©sentatif de toutes les unitÃ©s, mais sinon il nâ€™y a aucune raison de sâ€™attendre Ã  ce quâ€™il le soit.<a href="#fnref7" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn8"><p>InterprÃ©tez â€œ<span class="math inline">\(A\)</span> cause <span class="math inline">\(B\)</span>, en moyenneâ€ comme â€œlâ€™effet moyen de <span class="math inline">\(A\)</span> sur <span class="math inline">\(B\)</span> est positifâ€.<a href="#fnref8" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn9"><p>Certains rÃ©interprÃ¨tent la question des â€œcauses des effetsâ€ comme suit : quelles sont les causes qui ont des effets sur les rÃ©sultats. Voir Andrew Gelman and Guido Imbens, â€œWhy ask why? Forward causal inference and reverse causal questionsâ€, NBER Working Paper No.&nbsp;19614 (Nov.&nbsp;2013).<a href="#fnref9" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn10"><p>Voir, par exemple, Tian, J., Pearl, J. 2000. â€œProbabilities of Causation: Bounds and Identification.â€ Annals of Mathematics and Artificial Intelligence 28:287â€“313.<a href="#fnref10" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/methods\.egap\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>