<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alyssa René Heinze">

<title>10 Things to Know About Heterogeneous Treatment Effects – Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/egap-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides.html"> 
<span class="menu-text">Methods guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">10 Things to Know About Heterogeneous Treatment Effects</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10 Things to Know About Heterogeneous Treatment Effects</h1>
</div>

<div class="quarto-title-meta">
    
    
    
    
</div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Summary</div>
    <p>This guide discusses the theoretical and policy relevance of heterogeneous treatment effects, which is when effects vary by individual or group. It also discusses and demonstrates methods for estimating how effects vary and interpreting results: from testing for heterogeneity, to estimating subgroup treatment effects and their differences, to addressing the pitfalls of multiple comparisons and ad hoc searches for heterogeneity.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
  </div>
</div>
</header>

<nav id="TOC" role="doc-toc">
    <h4 id="toc-title">Contents</h4>
   
  <ul>
  <li><a href="#what-is-treatment-effect-heterogeneity" id="toc-what-is-treatment-effect-heterogeneity"><span class="header-section-number">1</span> What is treatment effect heterogeneity?</a></li>
  <li><a href="#why-is-treatment-effect-heterogeneity-important" id="toc-why-is-treatment-effect-heterogeneity-important"><span class="header-section-number">2</span> Why is treatment effect heterogeneity important?</a></li>
  <li><a href="#treatment-effect-heterogeneity-the-general-case" id="toc-treatment-effect-heterogeneity-the-general-case"><span class="header-section-number">3</span> Treatment effect heterogeneity: The general case</a></li>
  <li><a href="#treatment-effect-heterogeneity-conditional-average-treatment-effects-cates" id="toc-treatment-effect-heterogeneity-conditional-average-treatment-effects-cates"><span class="header-section-number">4</span> Treatment effect heterogeneity: Conditional average treatment effects (CATEs)</a></li>
  <li><a href="#treatment-effect-heterogeneity-differences-between-cates" id="toc-treatment-effect-heterogeneity-differences-between-cates"><span class="header-section-number">5</span> Treatment effect heterogeneity: Differences between CATEs</a></li>
  <li><a href="#estimation" id="toc-estimation"><span class="header-section-number">6</span> Estimation</a></li>
  <li><a href="#hypothesis-testing-differences-in-cates" id="toc-hypothesis-testing-differences-in-cates"><span class="header-section-number">7</span> Hypothesis testing: Differences in CATEs</a></li>
  <li><a href="#multiple-comparisons" id="toc-multiple-comparisons"><span class="header-section-number">8</span> Multiple comparisons</a></li>
  <li><a href="#pre-analysis-plans" id="toc-pre-analysis-plans"><span class="header-section-number">9</span> Pre-analysis plans</a></li>
  <li><a href="#automate-exploratory-search-for-heterogeneous-effects" id="toc-automate-exploratory-search-for-heterogeneous-effects"><span class="header-section-number">10</span> Automate exploratory search for heterogeneous effects</a></li>
  <li><a href="#references" id="toc-references"><span class="header-section-number">11</span> References</a></li>
  </ul>
</nav>
<section id="what-is-treatment-effect-heterogeneity" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> What is treatment effect heterogeneity?</h1>
<p>A treatment may affect individuals or groups in different ways: this is treatment effect heterogeneity. The study of treatment effect heterogeneity involves estimating how treatment effects vary across individuals or groups within an experiment. For whom are there big effects? For whom are there small effects? For whom does treatment generate beneficial or adverse effects?</p>
</section>
<section id="why-is-treatment-effect-heterogeneity-important" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Why is treatment effect heterogeneity important?</h1>
<p>By investigating treatment effect heterogeneity, we may be able to learn about the conditions under which treatments are especially effective or ineffective. The results can contribute to program design decisions and enable deploying resources more effectively, for example to individuals for whom the treatment is likely to be effective.</p>
</section>
<section id="treatment-effect-heterogeneity-the-general-case" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Treatment effect heterogeneity: The general case</h1>
<p>First, we might want to know whether the treatment effect is the same for all individuals and groups within a study. We can state this in terms of the <em>variance</em> of individual-level treatment effects: if the treatment effect is the same for all individuals, then the variance of these effects would be zero. To probe this, we can test the null hypothesis that the variance of the individual-level treatment effects is zero. But we never get to see the treatment effect for any particular individual, only the outcome for each person either in the treatment or in the control condition.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>What might treatment effect heterogeneity look like in practice? In one example, Eric Kramon, Sarah Brierley, and George Ofosu find in <a href="https://egap.org/resource/the-moderating-effect-of-debates-in-ghana/">The Moderating Effect of Debates in Ghana</a> that the impact of viewing parliamentary debates on candidate evaluation and vote choice vary by partisanship. In another example, <span class="citation" data-cites="blair2021">Blair (<a href="#ref-blair2021" role="doc-biblioref">2021</a>)</span> failed to find evidence of heterogeneous treatment effects of community policing interventions across six geographic sites in the Global South.</p>
</section>
<section id="treatment-effect-heterogeneity-conditional-average-treatment-effects-cates" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Treatment effect heterogeneity: Conditional average treatment effects (CATEs)</h1>
<p>Second, we might want to know whether specific groups of individuals in the study are impacted differently by our treatment. A structured, theory-driven inquiry of treatment effect heterogeneity involves pre-specifying and investigating conditional average treatment effects (CATEs). A CATE is an average treatment effect specific to a subgroup of individuals, where the subgroup is defined by the attributes of the individuals, such as the average treatment effect (ATE) among women. These attributes may also be attributes of the context in which the experiment occurs (e.g., the ATE among individuals at a specific site in a multi-site field experiment).<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p><em>An important aside on estimation</em>: It is generally a good idea to avoid conditioning on variables whose values could have been affected by the treatment itself (called post-treatment variables). This is to ensure the unbiased estimation of conditional average treatment effects. Some researchers may be interested in post-treatment effect modification, or (in the regression context) the interaction between a treatment and a post-treatment covariate. For example, how do the effects of a job search assistance program vary with participants’ levels of depression during the follow-up period? However, conditioning on a post-treatment covariate may lead to bias. See <span class="citation" data-cites="angristpischke">Angrist and Pischke (<a href="#ref-angristpischke" role="doc-biblioref">2009</a>)</span> for more on so-called “bad” controls. There is a burgeoning body of methodological research on the conditions under which CATEs involving post-treatment covariates are identified. These methods rely on model-based identification.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</section>
<section id="treatment-effect-heterogeneity-differences-between-cates" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Treatment effect heterogeneity: Differences between CATEs</h1>
<p>Third, we might be interested in the difference between two CATEs. For example, does our treatment work differently on average for men versus women? Stated differently, we might want to know whether the difference in ATEs between women and men in the experiment (sometimes called the interaction effect between the treatment and gender) is equal to or different from zero.</p>
<p><em>An aside on causal interpretation</em>: The variable(s) that define the subgroups that you compare may or may not have been experimentally manipulated. If it was not, then we have a treatment-by-covariate interaction that can be interpreted as a <em>descriptive</em> measure of association between the covariate and the treatment effect, but should not be interpreted as the <em>causal</em> effect of a change in the covariate value on the ATE.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Treatment-by-treatment interactions are differences in CATEs where the personal or contextual attribute defining subgroups <em>is</em> experimentally manipulated. Because that other treatment is randomly assigned, treatment-by-treatment interactions may be interpreted causally. Factorial and partial factorial designs allow researchers to randomly assign individuals to different combinations of “cross-cutting” treatment conditions and to estimate treatment-by-treatment interactions. <!-- as allowed by the design. --> <!-- Changed referring to the other factor as a covariate and referred to it as the other treatment --></p>
</section>
<section id="estimation" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Estimation</h1>
<p>Estimating CATEs and differences between CATEs (interaction effects) is straightforward. For the CATE, estimate the ATE among individuals in the specific subgroup of interest. For differences in CATEs, take the difference between relevant estimated CATEs. CATEs and differences in CATEs (interaction effects) may also be estimated in a regression framework.</p>
<p>Imagine a hypothetical experiment evaluating the effect of a job training program on future earnings. Let <span class="math inline">\(Y\)</span> be the outcome (future earnings), <span class="math inline">\(Z\)</span> be the treatment variable (1=job training program, 0=control), and <span class="math inline">\(X\)</span> be a pre-treatment covariate (1=scholarship receipt, 0=no scholarship).</p>
We can write down a regression model that can aid us in estimating the CATEs (the ATE of the job training program among those who receive a scholarship and among those who do not) and the interaction effect (the difference between these two CATEs).
<span class="math display">\[\begin{aligned}
Y_i &amp;= \alpha + \beta Z_i + \gamma X_i + \delta Z_iX_i + \varepsilon_i \label{alt}
\end{aligned}\]</span>
<p>The ATE of the job training program among individuals who do not receive a scholarship is <span class="math inline">\(\beta\)</span>. The ATE of the job training program among individuals who do receive a scholarship is <span class="math inline">\(\beta + \delta\)</span>.</p>
<p>The coefficient <span class="math inline">\(\delta\)</span> is the interaction effect and is interpreted as the ATE of the job training program among individuals receiving a scholarship minus the ATE of the job training program among individuals not receiving a scholarship. This has a causal interpretation (i.e., <span class="math inline">\(\delta\)</span> is a treatment-by-treatment interaction) when scholarships are randomly assigned and a descriptive interpretation (i.e., <span class="math inline">\(\delta\)</span> is a treatment-by-covariate interaction) when scholarships are not randomly assigned.</p>
</section>
<section id="hypothesis-testing-differences-in-cates" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Hypothesis testing: Differences in CATEs</h1>
<p>We might want to test whether an estimated interaction effect is just the result of noise in the data rather than reflecting a true difference in CATEs. We can take one of two approaches. A common practice in the regression approach is to use the standard error for the interaction coefficient in the regression output. For more on how to read regression table output, see <a href="https://methods.egap.org/guides/interpretation/regression-table_en.html">10 Things You Need to Know About Reading a Regression Table</a>. Alternatively, one can take a randomization inference approach. This entails generating a full schedule of potential outcomes under the null hypothesis that the true treatment effect is constant and equal to the estimated ATE. Then we would simulate random assignment a large number of times, and calculate how often the simulation produces an estimate of the interaction effect is at least as large in absolute value as the actual estimate. For more on randomization inference, see <a href="https://methods.egap.org/guides/analysis-procedures/randomization-inference_en.html">10 Things You Need to Know About Randomization Inference</a>.</p>
<p>One can also combine these two methods, conducting randomization inference in a regression framework. For two-sided tests, we can use the <span class="math inline">\(F\)</span>-statistic as the test statistic, where the null model is <span class="math display">\[
\begin{aligned}
Y_i &amp;= \alpha + \beta Z_i + \gamma X_i + \varepsilon_i
\end{aligned}
\]</span> and the alternative model is <span class="math display">\[
\begin{aligned}
Y_i &amp;= \alpha + \beta Z_i + \gamma X_i + \delta Z_iX_i + \varepsilon_i .
\end{aligned}
\]</span></p>
<p>The coefficient on the interaction term may be used as the test statistic for one-sided tests, given the appropriate model.</p>
<p><em>An aside on interpretation</em>: It’s important to distinguish between difference in significance and difference in effects. If, for example, our evidence suggests that the ATE among female study participants is significantly different from zero, but that the ATE among male participants is not, this <em>doesn’t</em> necessarily mean that the two CATEs are different from each other. Instead, we should use a test of the difference between CATEs as described above.</p>
</section>
<section id="multiple-comparisons" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Multiple comparisons</h1>
<p>Researchers interested in heterogeneous treatment effects are likely to encounter the problem of multiple comparisons: for example, when numerous subgroup analyses are conducted, the probability that at least one result looks statistically significant may be considerably greater than the specified alpha level (typically 5 percent) even when the treatment has no effect on anyone.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>One way to mitigate the multiple comparisons problem is to reduce the number of tests conducted, for example, by analyzing a small number of pre-specified subgroups. Another approach is to adjust the <span class="math inline">\(p\)</span>-values to account for the fact that multiple hypotheses are being tested simultaneously. For more on how to implement various methods of adjustment for multiple comparisons, see <a href="https://methods.egap.org/guides/analysis-procedures/multiple-comparisons_en.html">10 Things You Need to Know About Multiple Comparisons</a>.</p>
</section>
<section id="pre-analysis-plans" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Pre-analysis plans</h1>
<p>Pre-specifying the investigation of heterogeneous treatment effects has many benefits. First, we can reduce the numbers of CATEs and interactions under consideration for hypothesis testing by clearly indicating which tests are of primary interest in a registered pre-analysis plan (PAP). Additional subgroup analyses can be conceptualized and specified as exploratory or descriptive analyses in the PAP. Another bonus is that if we prefer a one-sided test, we can commit to that choice in the PAP before seeing the outcome data, so that we “cannot be justly accused of cherry-picking the test after the fact” <span class="citation" data-cites="olken_2015">(<a href="#ref-olken_2015" role="doc-biblioref">Olken 2015</a>)</span>. See our guide <a href="https://methods.egap.org/guides/planning/pap_en.html">10 Things to Know About Pre-Analysis Plans</a> for more on pre-registration. Further, if we want to demonstrate that heterogeneous effects do not exist (and are not, for example, what is driving a null result), pre-specifying theoretically derived expectations around lack of treatment effect heterogeneity can be useful.</p>
</section>
<section id="automate-exploratory-search-for-heterogeneous-effects" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Automate exploratory search for heterogeneous effects</h1>
<p>Machine learning methods can be used to automate the search for systematic variation in treatment effects. These automated approaches are attractive because they minimize researchers’ discretion in selecting and testing interactions. They are also useful for conducting exploratory analyses, since these types of analyses are rarely pre-specified.</p>
<p>Popular machine learning methods for heterogeneous treatment effects include support vector machines (R package <a href="http://cran.r-project.org/web/packages/FindIt/index.html">FindIt</a>),<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Bayesian additive regression trees (R package <a href="http://cran.r-project.org/web/packages/BayesTree/index.html">BayesTree</a>),<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> classification and regression trees (R package <a href="https://github.com/susanathey/causalTree">causalTree</a>) <span class="citation" data-cites="athey_imbens_2016">(<a href="#ref-athey_imbens_2016" role="doc-biblioref">Athey and Imbens 2016</a>)</span>, random forests or “causal forests” <span class="citation" data-cites="wager_athey_2016">(<a href="#ref-wager_athey_2016" role="doc-biblioref">Wager and Athey 2016</a>)</span>, and kernel regularized least squares (R package <a href="http://cran.r-project.org/web/packages/KRLS/index.html">KRLS</a>).<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>In addition to single machine learning methods, ensemble methods may be used. Ensemble methods estimate a weighted average of multiple machine learning estimates of heterogeneous effects where the weights are a function of out-of-sample prediction performance.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
</section>
<section id="references" class="level1" data-number="11">




</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">11 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-anderson_2008" class="csl-entry" role="listitem">
Anderson, Michael L. 2008. <span>“Multiple Inference and Gender Differences in the Effects of Early Intervention: A Reevaluation of the Abecedarian, Perry Preschool, and Early Training Projects.”</span> <em>Journal of the American Statistical Association</em> 103: 1481–95.
</div>
<div id="ref-angristpischke" class="csl-entry" role="listitem">
Angrist, J., and J. Pischke. 2009. <em>Mostly Harmless Econometrics</em>. Princeton University Press.
</div>
<div id="ref-athey_imbens_2016" class="csl-entry" role="listitem">
Athey, Susan, and Guido W. Imbens. 2016. <span>“Recursive Partitioning for Heterogeneous Causal Effects.”</span> <em>Proceedings of the National Academy of Sciences</em> 113: 7353–60.
</div>
<div id="ref-bansak2021" class="csl-entry" role="listitem">
Bansak, K. 2021. <span>“Estimating Causal Moderation Effects with Randomized Treatments and Non-Randomized Moderators.”</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em> 184 (1): 65–86.
</div>
<div id="ref-blair2021" class="csl-entry" role="listitem">
Blair, Weinstein, G. 2021. <span>“Community Policing Does Not Build Citizen Trust in Police or Reduce Crime in the Global South.”</span> <em>Science</em> 1098.
</div>
<div id="ref-chipman_et_al_2010" class="csl-entry" role="listitem">
Chipman, H. A., E. I. George, and R. E. McCulloch. 2010. <span>“BART: Bayesian Additive Regression Trees.”</span> <em>Annals of Applied Statistics</em> 20 (1): 271–40.
</div>
<div id="ref-cook_farewell_1996" class="csl-entry" role="listitem">
Cook, Richard J., and Vern T. Farewell. 1996. <span>“Multiplicity Considerations in the Design and Analysis of Clinical Trials.”</span> <em>Journal of the Royal Statistical Society, Series A</em> 159: 93–110.
</div>
<div id="ref-gelman_et_al_2012" class="csl-entry" role="listitem">
Gelman, Andrew, Jennifer Hill, and Masanao Yajima. 2012. <span>“Why We (Usually) Don’t Have to Worry about Multiple Comparisons.”</span> <em>Journal of Research on Educational Effectiveness</em> 5: 189–211.
</div>
<div id="ref-gerber_green_2012" class="csl-entry" role="listitem">
Gerber, Alan S., and Donald P. Green. 2012. <em>Field Experiments: Design, Analysis, and Interpretation</em>. W.W. Norton.
</div>
<div id="ref-green_kern_2012" class="csl-entry" role="listitem">
Green, Donald P., and Holger L. Kern. 2012. <span>“Modeling Heterogeneous Treatment Effects in Survey Experiments with Bayesian Additive Regression Trees.”</span> <em>Public Opinion Quarterly</em> 76 (3): 491–511.
</div>
<div id="ref-grimmer_et_al_2014" class="csl-entry" role="listitem">
Grimmer, Justin, Solomon Messing, and Sean J. Westwood. 2014. <span>“Estimating Heterogeneous Treatment Effects and the Effects of Heterogeneous Treatments with Ensemble Methods.”</span>
</div>
<div id="ref-hainmueller_hazlett_2013" class="csl-entry" role="listitem">
Hainmueller, Jens, and Chad Hazlett. 2013. <span>“Kernel Regularized Least Squares: Reducing Misspecification Bias with a Flexible and Interpretable Machine Learning Approach.”</span> <em>Political Analysis</em>.
</div>
<div id="ref-hill_2011" class="csl-entry" role="listitem">
Hill, Jennifer L. 2011. <span>“Bayesian Nonparametric Modeling for Causal Inference.”</span> <em>Journal of Computational and Graphical Statistics</em> 20 (1): 217–40.
</div>
<div id="ref-imai_ratkovic_2013" class="csl-entry" role="listitem">
Imai, Kosuke, and Marc Ratkovic. 2013. <span>“Estimating Treatment Effect Heterogeneity in Randomized Program Evaluation.”</span> <em>Annals of Applied Statistics</em> 7 (1): 443–70.
</div>
<div id="ref-van_der_laan_et_al_2007" class="csl-entry" role="listitem">
Laan, Mark J. van der, Eric Polley, and Alan Hubbard. 2007. <span>“Super Learner.”</span> <em>Statistical Applications in Genetics and Molecular Biology</em> 6 (1).
</div>
<div id="ref-olken_2015" class="csl-entry" role="listitem">
Olken, Benjamin A. 2015. <span>“Promises and Perils of Pre-Analysis Plans.”</span> <em>Journal of Economic Perspectives</em> 29 (3): 61–80.
</div>
<div id="ref-schulz_grimes_2005a" class="csl-entry" role="listitem">
Schulz, Kenneth F., and David A. Grimes. 2005a. <span>“Multiplicity in Randomised Trials i: Endpoints and Treatments.”</span> <em>Lancet</em> 365: 1591–95.
</div>
<div id="ref-schulz_grimes_2005b" class="csl-entry" role="listitem">
———. 2005b. <span>“Multiplicity in Randomised Trials II: Subgroups and Interim Analyses.”</span> <em>Lancet</em> 365: 1657–61.
</div>
<div id="ref-stephens_et_al_2016" class="csl-entry" role="listitem">
Stephens, Alisa, Luke Keele, and Marshall Joffe. 2016. <span>“Generalized Structural Mean Models for Evaluating Depression as a Post-Treatment Effect Modifier of a Jobs Training Intervention.”</span>
</div>
<div id="ref-vansteelandt_2010" class="csl-entry" role="listitem">
Vansteelandt, S. 2010. <span>“Estimation of Controlled Direct Effects on a Dichotomous Outcome Using Logistic Structural Direct Effect Models.”</span> <em>Biometrika</em> 97: 921–34.
</div>
<div id="ref-vansteelandt_goetghebeur_2003" class="csl-entry" role="listitem">
Vansteelandt, S., and E. Goetghebeur. 2003. <span>“Causal Inference with Generalized Structural Mean Models.”</span> <em>Journal of the Royal Statistical Society, Series B</em> 65 (817-835).
</div>
<div id="ref-vansteelandt_goetghebeur_2004" class="csl-entry" role="listitem">
———. 2004. <span>“Using Potential Outcomes as Predictors of Treatment Activity via Strong Structural Mean Models.”</span> <em>Statistica Sinica</em> 14: 907–25.
</div>
<div id="ref-wager_athey_2016" class="csl-entry" role="listitem">
Wager, Stefan, and Susan Athey. 2016. <span>“Estimation and Inference of Heterogeneous Treatment Effects Using Random Forests.”</span>
</div>
<div id="ref-westfall_et_al_2011" class="csl-entry" role="listitem">
Westfall, Peter H., Randall D. Tobias, and Russell D. Wolfinger. 2011. <em>Multiple Comparisons and Multiple Tests Using SAS</em>. 2nd Ed. SAS Institute.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This guide draws heavily from <span class="citation" data-cites="gerber_green_2012">Gerber and Green (<a href="#ref-gerber_green_2012" role="doc-biblioref">2012</a>)</span> and from <a href="http://www.donaldgreen.com/">Don Green</a>’s course notes on experimental methods at Columbia University and builds on an older version of this guide by <a href="https://albertfang.com/">Albert Fang</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This is known as the Fundamental Problem of Causal Inference. For more background, see <a href="https://methods.egap.org/guides/causal-inference/causal-inference_en.html">10 Things You Need to Know About Causal Inference</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>We can also define ATEs for subgroups defined by the individuals’ treatment status (e.g., the ATE among those who were assigned to treatment, also called the ATT or average treatment effect on the treated) or individuals’ post-treatment outcomes. We do not focus on these types of CATEs because of estimation challenges described below.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>For further reading (at an advanced technical level), see <span class="citation" data-cites="vansteelandt_goetghebeur_2003">Vansteelandt and Goetghebeur (<a href="#ref-vansteelandt_goetghebeur_2003" role="doc-biblioref">2003</a>)</span>; <span class="citation" data-cites="vansteelandt_goetghebeur_2004">Vansteelandt and Goetghebeur (<a href="#ref-vansteelandt_goetghebeur_2004" role="doc-biblioref">2004</a>)</span>; <span class="citation" data-cites="vansteelandt_2010">Vansteelandt (<a href="#ref-vansteelandt_2010" role="doc-biblioref">2010</a>)</span>; <span class="citation" data-cites="stephens_et_al_2016">Stephens, Keele, and Joffe (<a href="#ref-stephens_et_al_2016" role="doc-biblioref">2016</a>)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>See <span class="citation" data-cites="bansak2021">Bansak (<a href="#ref-bansak2021" role="doc-biblioref">2021</a>)</span> for more on causal moderation.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>For more background and a range of views on the multiple comparisons problem, see, e.g.: <a href="https://methods.egap.org/guides/analysis-procedures/multiple-comparisons_en.html">10 Things You Need to Know About Multiple Comparisons</a>; <span class="citation" data-cites="cook_farewell_1996">Cook and Farewell (<a href="#ref-cook_farewell_1996" role="doc-biblioref">1996</a>)</span>; <span class="citation" data-cites="schulz_grimes_2005a">Schulz and Grimes (<a href="#ref-schulz_grimes_2005a" role="doc-biblioref">2005a</a>)</span>; <span class="citation" data-cites="schulz_grimes_2005b">Schulz and Grimes (<a href="#ref-schulz_grimes_2005b" role="doc-biblioref">2005b</a>)</span>; <span class="citation" data-cites="anderson_2008">Anderson (<a href="#ref-anderson_2008" role="doc-biblioref">2008</a>)</span>; <span class="citation" data-cites="westfall_et_al_2011">Westfall, Tobias, and Wolfinger (<a href="#ref-westfall_et_al_2011" role="doc-biblioref">2011</a>)</span>; <span class="citation" data-cites="gelman_et_al_2012">Gelman, Hill, and Yajima (<a href="#ref-gelman_et_al_2012" role="doc-biblioref">2012</a>)</span>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>See, for example, <span class="citation" data-cites="imai_ratkovic_2013">Imai and Ratkovic (<a href="#ref-imai_ratkovic_2013" role="doc-biblioref">2013</a>)</span>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>See <span class="citation" data-cites="chipman_et_al_2010">Chipman, George, and McCulloch (<a href="#ref-chipman_et_al_2010" role="doc-biblioref">2010</a>)</span>; <span class="citation" data-cites="hill_2011">Hill (<a href="#ref-hill_2011" role="doc-biblioref">2011</a>)</span>; <span class="citation" data-cites="green_kern_2012">Green and Kern (<a href="#ref-green_kern_2012" role="doc-biblioref">2012</a>)</span>.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>See <span class="citation" data-cites="hainmueller_hazlett_2013">Hainmueller and Hazlett (<a href="#ref-hainmueller_hazlett_2013" role="doc-biblioref">2013</a>)</span>.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>See <span class="citation" data-cites="van_der_laan_et_al_2007">Laan, Polley, and Hubbard (<a href="#ref-van_der_laan_et_al_2007" role="doc-biblioref">2007</a>)</span>; <span class="citation" data-cites="grimmer_et_al_2014">Grimmer, Messing, and Westwood (<a href="#ref-grimmer_et_al_2014" role="doc-biblioref">2014</a>)</span>.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/methods\.egap\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>