<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul Testa">
<meta name="author" content="Eric Dobbie">

<title>10 Types of Treatment Effect You Should Know About – Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/egap-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../guides.html"> 
<span class="menu-text">Methods guides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">10 Types of Treatment Effect You Should Know About</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">10 Types of Treatment Effect You Should Know About</h1>
</div>

<div class="quarto-title-meta">
    
    
    
    
</div>
  
</header>

<nav id="TOC" role="doc-toc">
    <h4 id="toc-title">Contents</h4>
   
  <ul>
  <li><a href="#causal-effects-as-comparisons-between-potential-outcomes" id="toc-causal-effects-as-comparisons-between-potential-outcomes"><span class="header-section-number">1</span> 1. Causal effects as comparisons between potential outcomes</a></li>
  <li><a href="#individual-treatment-effects" id="toc-individual-treatment-effects"><span class="header-section-number">2</span> 2. Individual treatment effects</a></li>
  <li><a href="#average-treatment-effects" id="toc-average-treatment-effects"><span class="header-section-number">3</span> 3. Average treatment effects</a></li>
  <li><a href="#population-and-sample-average-treatment-effects" id="toc-population-and-sample-average-treatment-effects"><span class="header-section-number">4</span> 4. Population and sample average treatment effects</a></li>
  <li><a href="#conditional-average-treatment-effects" id="toc-conditional-average-treatment-effects"><span class="header-section-number">5</span> 5. Conditional average treatment effects</a></li>
  <li><a href="#intent-to-treat-effects" id="toc-intent-to-treat-effects"><span class="header-section-number">6</span> 6. Intent-to-treat effects</a></li>
  <li><a href="#quantile-average-treatment-effects" id="toc-quantile-average-treatment-effects"><span class="header-section-number">7</span> 7. Quantile Average Treatment Effects</a></li>
  <li><a href="#average-marginal-component-effect" id="toc-average-marginal-component-effect"><span class="header-section-number">8</span> 8. Average marginal component effect</a></li>
  <li><a href="#direct-and-indirect-effects-and-eliminated-effects" id="toc-direct-and-indirect-effects-and-eliminated-effects"><span class="header-section-number">9</span> 9. Direct and indirect effects and Eliminated Effects</a></li>
  <li><a href="#treatment-effects-for-binary-outcomes-log-odds-treatment-effects-and-attributable-effects" id="toc-treatment-effects-for-binary-outcomes-log-odds-treatment-effects-and-attributable-effects"><span class="header-section-number">10</span> 10. Treatment Effects for Binary Outcomes: Log-Odds Treatment Effects and Attributable Effects</a></li>
  <li><a href="#references" id="toc-references"><span class="header-section-number">11</span> References</a></li>
  </ul>
</nav>
<p>This guide describes estimands, theoretical parameters of interest, of researchers might want to identify. This guide should help researchers choose an estimand of interest to address their specific research question. It builds on <a href="https://methods.egap.org/guides/causal-inference/causal-inference_en.html">10 Things to Know About Causal Inference</a>.</p>
<section id="causal-effects-as-comparisons-between-potential-outcomes" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 1. Causal effects as comparisons between potential outcomes</h1>
<p>If a person who took an aspirin would have had a worse headache if she had not taken the aspirin, then we say that the aspirin caused an improvement in her headache. That is, the outcome for this suffering person after taking an aspirin could have been either a bad headache or a mild headache. But the aspirin caused her to experience, an a researcher to observe, a mild headache rather than the potential bad headache. This is an illustration of what we mean when we say that causal effects are comparisons of potential outcomes (see our guide on <a href="https://egap.org/resource/10-things-to-know-about-causal-inference/">10 Things to Know About Causal Inference</a> to learn more about potential outcomes.</p>
<p>Researchers in every field are interested causal effects. Sometimes interest focuses on the average (say the average difference in headache severity across multiple people), or perhaps some other quantity like a ratio. This guide describes a few common causal effects that focus on averages.</p>
</section>
<section id="individual-treatment-effects" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 2. Individual treatment effects</h1>
<p>A first quantity of interest is the individual treatment effect. For this estimand a researcher would be interested in the effect of a treatment on each individual’s outcome. An individual could be a person, a household, a city, or any other level at which outcomes are measured. In the aspirin example, we could write <span class="math inline">\(Z_i=1\)</span> to indicate that person <span class="math inline">\(i\)</span> took an aspirin and <span class="math inline">\(Z_i=0\)</span> to mean that person did not take an aspirin. We use the variable <span class="math inline">\(Z\)</span> to refer to the experimental treatment and <span class="math inline">\(Y\)</span> will be the outcome.</p>
<p>In order to see an effect of a treatment on a person’s outcome, one would want to observe that person’s potential outcome under treatment <span class="math inline">\(Y_i(Z_i=1)\)</span> (which we write <span class="math inline">\(Y_i(1)\)</span> as a shorthand) and the potential outcome under control <span class="math inline">\(Y_i(0)\)</span>. Taking the difference between these quantities would give the additive individual treatment effect for subject i: <span class="math inline">\(τ_{i}=Y_{i}(1)−Y_{i}(0)\)</span>. If we wanted to learn about the effect of a treatment on a ratio of outcomes (say, income was the outcome), we would write <span class="math inline">\(\tau_{i}=Y_{i}(1)/Y_{i}(0)\)</span> as another individual treatment effect. Since we can only observe either <span class="math inline">\(Y_{i}(1)\)</span> or <span class="math inline">\(Y_{i}(0)\)</span> these individual treatment effects (and any others using those two potential outcomes) are unknowable although we can hypothesize about individual treatment effects and test those hypotheses and/or we can estimate individual treatment effects using models of outcomes.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</section>
<section id="average-treatment-effects" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 3. Average treatment effects</h1>
<p>Some reseachers want to learn about the average treatment effect (ATE) across all observations in our experiment. Which we can define as the average of the individual level additive treatment effects across all units in the study.</p>
<p><span class="math display">\[ATE≡\frac{1}{N}∑^{N}_{i=1}τ_{i}=\frac{∑^{N}_{1}Y_{i}(1)}{N}−\frac{∑^{N}_{1}Y_{i}(0)}{N}\]</span></p>
<p>See <a href="https://methods.egap.org/guides/causal-inference/x-cause-y_en.html">10 Strategies for Figuring out if X Causes Y</a> for information on how we can <strong>estimate</strong> the ATE.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="population-and-sample-average-treatment-effects" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 4. Population and sample average treatment effects</h1>
<p>When defining the average treatment effect, it isn’t immediately clear which units should be included in the <em>all</em> part of <em>all units</em>. Often we want to use our sample to make statements about some broader population.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Let <span class="math inline">\(S_i\)</span> be an indicator for whether an subject is in our sample. The sample average treatment effect (SATE) is defined simply as <span class="math inline">\(SATE = E(Y_i(1)−Y_i(0)|S_i=1)\)</span> and the population <span class="math inline">\(PATE = E(Y_i(1)−Y_i(0))\)</span>. If we are interested in the effect of the treatment within our sample, we would be interested in the sample average treatment effect. For estimating the effect of the treatment on units that we do not observe but which we could observe, we would instead be interested in the population average treatment effect. With a large random sample from a well-defined population with full compliance with treatment, our SATE and PATE are equal in expectation.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</section>
<section id="conditional-average-treatment-effects" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 5. Conditional average treatment effects</h1>
<p>Sometimes the theory or policy intervention motivating the study suggests that the treatment effect should differ for different sorts of people.</p>
<p>Random assignment ensures that treatment is independent of potential outcomes and any (observed and unobserved) covariates.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Sometimes, however, we have additional information about the experimental units as they existed <em>before</em> the experiment was fielded. We can call such a baseline variable or “covariate”, <span class="math inline">\(X_{i}\)</span>. This information can can help us understand how treatment effects vary across subgroups. For example, we may suspect that men and women respond differently to treatment, and we can define an estimand that will have different values for each subgroup separately. We can define the conditional average treatment effect as:</p>
<p><span class="math display">\[CATE=E(Y_{i}(1)−Y_{i}(0)∣Z_{i},X_{i})\]</span></p>
<p>A version of a conditional ATE are the average treatment effects defined specifically for those to whom the treatment is administered. We define the average effects of treatment among the treated (ATT) and the control (ATC) as follows:</p>
<p><span class="math display">\[ATT=E(Y_i(1)-Y_i(0)|Z_i=1)=E(Y_i(1)|Z_i=1)-E(Y_i(0)|Z_i=1)\]</span> <span class="math display">\[ATC=E(Y_i(1)-Y_i(0)|Z_i=0)=E(Y_i(1)|Z_i=0)-E(Y_i(0)|Z_i=0)\]</span></p>
<p>Informally, the ATT is the effect for those that we treated; ATC is what the effect <em>would</em> be for those we did not treat.</p>
<p>Those interested in further reading on conditional average treatment effects should see chapter 9 of <span class="citation" data-cites="gerber_green_2012">Gerber and Green (<a href="#ref-gerber_green_2012" role="doc-biblioref">2012</a>)</span>.</p>
</section>
<section id="intent-to-treat-effects" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 6. Intent-to-treat effects</h1>
<p>Outside of a controlled laboratory setting, the subjects we assign to treatment often are not the same as the subjects who actually receive the treatment. For example, a public health agency could send postcards to people to encourage people to take aspirins when they have a headache, but they cannot force people to swallow the pills. Some people will take a pill because they were encouraged to do so by the postcards, but other will not comply with the instructions. We call this issue noncompliance<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. The intent-to-treat effect (ITT) is the effect of giving someone the opportunity to receive treatment. In the absence of noncompliance, the ITT is the same as the ATE. We can define ITT as:</p>
<p><span class="math display">\[ITT = E[Y_i(Z=1)] - E[Y_i(Z=0)]\]</span></p>
<p>Where <span class="math inline">\(Z\)</span> is an indicator for whether a subject has been <em>assigned</em> to treatment rather than indicating whether they <em>received</em> treatment.</p>
<p>What if you are interested in figuring out the effects of a treatment on those people who actually took up the treatment and not just those people that were administered the treatment? In this case, you would be interested in the complier average causal effect (CACE) or local average treatment effect (LATE). If we write <span class="math inline">\(D_i(Z_i=1)=1\)</span> to mean that a person would take a “dose” of an assigned treatment and <span class="math inline">\(D_i(Z_i=0)=0\)</span> to mean that a person would not take a dose of a treatment if it was not assigned, we can write the CACE as:</p>
<p><span class="math display">\[CACE= E[Y_i(1)-Y_i(0)|D_i(1)-D_i(0) = 1]\]</span></p>
<p>Which is the average effect conditional on the subject being a complier, a type that takes the treatment when assigned to treatment and does not take the treatment when assigned to control.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</section>
<section id="quantile-average-treatment-effects" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 7. Quantile Average Treatment Effects</h1>
<p>The ATE focuses on the effect for a typical person, but we often also care about the distributional consequences of our treatment. We want to know not just whether our treatment raised average income, but also whether it made the distribution of income in the study more or less equal.</p>
<p>Claims about distributions are difficult. Even though we can estimate the ATE from a difference of sample means, in general, we cannot make statements about the joint distribution of potential outcomes <span class="math inline">\((F(Y_i(1),Y_i(0)))\)</span> without further assumptions. Typically, these assumptions either limit our analysis to a specific sub-population<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> or require us to assume some form of rank invariance in the distribution of responses to treatment effects.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<p>If these assumptions are justified for our data, we can obtain consistent estimates of quantile treatment effects (QTE) using quantile regression.<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> Just as linear regression estimates the ATE as a difference in means (or, when covariates are used in the model, from a conditional mean), quantile regression fits a linear model to a conditional quantile and this model can then be used to estimates the effects of treatment for that particular quantile of the outcome. The approach can be extended to include covariates and instruments for non-compliance. Note that the interpretation of the QTE is for a given quantile, not an individual at that quantile.</p>
</section>
<section id="average-marginal-component-effect" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> 8. Average marginal component effect</h1>
<p>For a conjoint experiment (see <a href="https://methods.egap.org/guides/data-collection/survey-experiments_en.html">10 Things to Know About Survey Experiments</a>), one might be interested in the marginal effect of changing one attribute. The average marginal component effect (AMCE) gives the average causal effect of changing an attribute from one value to another, while holding equal the joint distribution of the other attributes in the design, averaged over this distribution.</p>
<p>The probabilities associated with each factor are also informed by the choice of estimand. For the uniform AMCE (uAMCE), each factor is independently and uniformly marginalized. In contrast, the population AMCE (pAMCE) is marginalized over the target population distribution of profiles. The AMCE is always defined with respect to the distribution used for the random assignment; so if you change the randomization distribution, the interpretation changes.<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a></p>
</section>
<section id="direct-and-indirect-effects-and-eliminated-effects" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> 9. Direct and indirect effects and Eliminated Effects</h1>
<p>When discussing the effects of a treatment, one could be interested in the total effect of the treatment on the outcome, as assumed above, or components of the effect of the treatment. Specifically, one might be interested in the direct effect of the treatment or any number of indirect effects of a treatment. Largely, interest in direct and indirect effects comes from an interest in <a href="https://methods.egap.org/guides/research-questions/mechanisms_en.html">mechanisms</a>. It might be of interest to a researcher <em>how</em> the effect happens, rather than simply knowing whether all of the mechanisms together produce an effect.</p>
<p>When trying to decompose an effect into the components of indirect and direct effects, one might look to mediation analysis. Suppose that there is one mediator, potential outcomes can now be written as <span class="math inline">\(Y_i(Z_i)=Y_i(Z_i,M_i(Z_i))\)</span>, where <span class="math inline">\(Z_i\)</span> is the treatment status (say, <span class="math inline">\(Z_i=1\)</span> or <span class="math inline">\(Z_i=0\)</span>) and <span class="math inline">\(M_i(Z_i)\)</span> is a function for how the mediator responds to a given treatment assignment. Writing out the total effect in direct and indirect effects gives the following:</p>
<p><span class="math display">\[\begin{align}
\underbrace{Y_i(1)-Y_i(0)}_{\text{Total Effect}} = \underbrace{Y_i(1,M_i(1))-Y_i(1,M_i(0))}_{\text{Indirect Effect}}+\underbrace{Y_i(1,M_i(0))-Y_i(0,M_i(0))}_{\text{Direct Effect}} \nonumber
\end{align}\]</span></p>
<p>Equivalently,</p>
<p><span class="math display">\[\begin{align}
\underbrace{Y_i(1)-Y_i(0)}_{\text{Total Effect}} = \underbrace{Y_i(0,M_i(1))-Y_i(0,M_i(0))}_{\text{Indirect Effect}}+\underbrace{Y_i(1,M_i(1))-Y_i(0,M_i(1))}_{\text{Direct Effect}} \nonumber
\end{align}\]</span></p>
<p>See <span class="citation" data-cites="glynn2021advances">Glynn (<a href="#ref-glynn2021advances" role="doc-biblioref">2021</a>)</span> for more about mediation analysis.</p>
<p>When interested in indirect effects, one potential estiamnd is the eliminated effect. From section 9 it is clear to see that getting at the indirect effect is, at minimum, challenging. It is not immediately clear what it means to have the mediator respond to the treatment without the treatment being received as in <span class="math inline">\(Y_i(0,M_i(1))\)</span>. These cross-world potential outcomes are not possible to observe.</p>
<p>Despite this difficulty, it might be possible in some settings to manipulate the mediator, getting at controlled direct effects, where the researcher forces the mediator to respond in a certain way. Let the potential outcome where the subject is assigned to treatment and the mediator is forced to respond as if assigned to control be written as <span class="math inline">\(Y_i(1,0)\)</span>. The eliminated effect is the total effect minus the controlled direct effect.</p>
<p><span class="math display">\[\begin{align}
\underbrace{Y_i(1)-Y_i(0)}_{\text{Total Effect}} &amp;- \underbrace{Y_i(1,0)-Y_i(0,0)}_{\text{Controlled Direct Effect}} \nonumber \\
&amp;= \underbrace{Y_i(1,M_i(1))-Y_i(1,M_i(0))}_{\text{Indirect Effect}} \nonumber \\
&amp;+ \underbrace{[(Y_i(1,1)-Y_i(0,1)) - (Y_i(1,0)- Y_i(0,0))]*M_i(0)}_{\text{Mediated Interaction}} \nonumber
\end{align}\]</span></p>
<p>Equivalently:</p>
<p><span class="math display">\[\begin{align}
\underbrace{Y_i(1)-Y_i(0)}_{\text{Total Effect}} &amp;- \underbrace{Y_i(10)-Y_i(00)}_{\text{Controlled Direct Effect}} \nonumber \\
&amp;= \underbrace{Y_i(0,M_i(1))-Y_i(0,M_i(0))}_{\text{Indirect Effect}} \nonumber \\
&amp;+ \underbrace{[(Y_i(1,1)-Y_i(0,1)) - (Y_i(1,0)- Y_i(0,0))]*M_i(1)}_{\text{Mediated Interaction}} \nonumber
\end{align}\]</span></p>
<p>This effect can be observed, as both the total effect and the controlled direct effect can be obtained so long as the mediator is able to be manipulated.<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a></p>
</section>
<section id="treatment-effects-for-binary-outcomes-log-odds-treatment-effects-and-attributable-effects" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> 10. Treatment Effects for Binary Outcomes: Log-Odds Treatment Effects and Attributable Effects</h1>
<p>Average treatment effects seem a bit hard to interpret when outcomes are not continuous. For example, a very common binary outcome in the study of elections is coded as 1 when subjects voted, and 0 when they did not. The average effect might be 0.2, but what does it really mean to say that a treatment increased voting by 0.2 for individual? Estimating causal effects for dichotomous outcomes requires some additional care, particularly when including covariates. A common quantity of causal interest for dichotomous outcomes is our treatment’s effect on the log-odds of success, defined for the experimental pool as:</p>
<p><span class="math display">\[\Delta = log\frac{E(Y_i(1))}{1-E(Y_i(1))} - log\frac{E(Y_i(0))}{1-E(Y_i(0))}\]</span></p>
<p><span class="citation" data-cites="freemand_2008b">(<a href="#ref-freemand_2008b" role="doc-biblioref"><strong>freemand_2008b?</strong></a>)</span> shows that the coefficient from a logistic regression adjusting for covariates in a randomized experiments produces biased estimates of this causal effect. The basic intuition for Freedman’s argument comes from the fact that taking the log of averages is not the same as taking the average of logs and so the treatment coefficient estimated from a logistic regression conditioning on covariates will not provide a consistent estimator of log-odds of success. Instead, Freedman recommends taking the predicted probabilities varying subjects’ treatment status but maintaining their observed covariate profiles to produce a consistent estimator of the log-odds.</p>
<p>An alternative approach with binary outcomes is to infer about the <em>sum</em> of successes rather than the difference in proportions. <span class="citation" data-cites="rosenbaum_2002a">Rosenbaum (<a href="#ref-rosenbaum_2002a" role="doc-biblioref">2002</a>)</span> introduces this quantity in the context of matched observational studies and <span class="citation" data-cites="hansen_bowers_2009">Hansen and Bowers (<a href="#ref-hansen_bowers_2009" role="doc-biblioref">2009</a>)</span> use it in a randomized field experiment where voting or not voting is measured at the individual level.</p>
<p>Consider a simple case with a dichotomous outcome and treatment. Let <span class="math inline">\(A\)</span> be the number of outcomes attributable to treatment, that is, the number of cases in which <span class="math inline">\(Y_i\)</span> equaled 1 among treated subjects which would not have occurred had these units been assigned to control. For a range of <span class="math inline">\(A\)</span>’s, we adjust the observed contingency table of outcomes among the treated, and compare this resulting distribution to a known null distribution (the distribution of outcomes we would have observed had treatment had no effect). The resulting range of <span class="math inline">\(A\)</span>’s for which our test continues to reject the null hypothesis of no effect provides a range of effects that are attributable to our treatment.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Table 1</th>
<th><span class="math inline">\(D=1\)</span></th>
<th><span class="math inline">\(D=0\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(Y=1\)</span></td>
<td><span class="math inline">\(\sum Y_iD_i-A\)</span></td>
<td><span class="math inline">\((1-Y_i)(D_i)\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(Y=0\)</span></td>
<td><span class="math inline">\(\sum Y_i(1-D_i)+A\)</span></td>
<td><span class="math inline">\(\sum (1-Y_i)(1-D_i)\)</span></td>
</tr>
</tbody>
</table>
<p>First, we define an attributable effect as <span class="math inline">\(A=∑_iZ_iτ_i\)</span>, where <span class="math inline">\(τ_i=Y_i(1)−Y_i(0)\)</span> and <span class="math inline">\(y∈0,1\)</span>. That is, the attributable effect is the number of “yes” or “success” or other “1” responses among those treated that we would not have seen if they had been assigned control.</p>
<p>Second, notice that if we write the set <span class="math inline">\(U\)</span> as the experimental pool, and the set of control units is a subset of the whole pool, <span class="math inline">\(C⊆U\)</span>, then we can write <span class="math inline">\(∑_{i∈C}Y_i−Y_i(0)=0\)</span>. This means that we can represent <span class="math inline">\(A\)</span> using totals:</p>
<span class="math display">\[A = ∑_{i=1}^NZ_iτ_i=∑_{i=1}^NZ_i(Y_i(1)−Y_i(0))=∑_{i∉C}Y_i(1)−∑_{i∉C}Y_i(0)\]</span> <span class="math display">\[  = ∑_{i∉C}Y_i−∑_{i∉C}Y_i(0)=∑_{i=1}^NY_i−∑_{i=1}^NY_i(0)=t_U−t_C\]</span>
<center>
= observed total overall (fixed and observed) - total outcome under control (unobserved, to estimate)
</center>
<p>Third, this representation allows us to produce a design-based confidence interval for <span class="math inline">\(\hat{A}\)</span> by drawing on the survey sampling literature about statistical inference for sample totals because the observed total number of successful outcomes (the total number of people voting in the example), <span class="math inline">\(t_U\)</span>, is fixed across randomizations.</p>
</section>
<section id="references" class="level1" data-number="11">




</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">11 References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-acharya2018analyzing" class="csl-entry" role="listitem">
Acharya, Avidit, Matthew Blackwell, and Maya Sen. 2018. <span>“Analyzing Causal Mechanisms in Survey Experiments.”</span> <em>Political Analysis</em> 26 (4): 357–78.
</div>
<div id="ref-angrist_pischke_2008" class="csl-entry" role="listitem">
Angrist, Joshua, and Jörn-Steffen Pischke. 2008. <em>Mostly Harmless Econometrics: An Empiricist’s Companion</em>. Princeton University Press.
</div>
<div id="ref-bansak2022using" class="csl-entry" role="listitem">
Bansak, Kirk, Jens Hainmueller, Daniel J Hopkins, and Teppei Yamamoto. 2022. <span>“Using Conjoint Experiments to Analyze Election Outcomes: The Essential Role of the Average Marginal Component Effect.”</span> <em>Political Analysis</em>, 1–19.
</div>
<div id="ref-coppock2019generalizing" class="csl-entry" role="listitem">
Coppock, Alexander. 2019. <span>“Generalizing from Survey Experiments Conducted on Mechanical Turk: A Replication Approach.”</span> <em>Political Science Research and Methods</em> 7 (3): 613–28.
</div>
<div id="ref-gerber_green_2012" class="csl-entry" role="listitem">
Gerber, Alan S., and Donald P. Green. 2012. <em>Field Experiments: Design, Analysis, and Interpretation</em>. WW Norton.
</div>
<div id="ref-glynn2021advances" class="csl-entry" role="listitem">
Glynn, Adam N. 2021. <span>“Advances in Experimental Mediation Analysis.”</span> In <em>Advances in Experimental Political Science</em>, edited by James N Druckman and Donald P Green, 257–70. Cambridge University Press.
</div>
<div id="ref-hansen_bowers_2009" class="csl-entry" role="listitem">
Hansen, Ben, and Jake Bowers. 2009. <span>“Attributing Effects to a Cluster-Randomized Get-Out-the-Vote Campaign.”</span> <em>Journal of the American Statistical Association</em> 104 (487): 873–85.
</div>
<div id="ref-imai_king_stuart_2008" class="csl-entry" role="listitem">
Imai, Kosuke, Gary King, and Elizabeth A. Stuart. 2008. <span>“Misunderstandings Between Experimentalists and Observationalists about Causal Inference.”</span> <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> 171 (2): 481–502.
</div>
<div id="ref-imbens_wooldridge_2007" class="csl-entry" role="listitem">
Imbens, Guido W., and Jeffrey M. Wooldridge. 2007. <span>“What’s New in Econometrics?”</span> <em>National Bureau of Economic Research Summer Institute</em>.
</div>
<div id="ref-liu2023multiple" class="csl-entry" role="listitem">
Liu, Guoer, and Yuki Shiraito. 2023. <span>“Multiple Hypothesis Testing in Conjoint Analysis.”</span> <em>Political Analysis</em>, 1–16.
</div>
<div id="ref-rosenbaum_2002a" class="csl-entry" role="listitem">
Rosenbaum, Paul R. 2002. <span>“Attributing Effects to Treatment in Matched Observational Studies.”</span> <em>Journal of the American Statistical Association</em> 97 (457): 183–92.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>See our <a href="https://egap.org/resource/10-things-to-know-about-hypothesis-testing/">10 Things to Know about Hypothesis Testing</a> to learn about hypothesis testing for causal inference.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>See also Chapter 2 of <span class="citation" data-cites="gerber_green_2012">Gerber and Green (<a href="#ref-gerber_green_2012" role="doc-biblioref">2012</a>)</span> or Chapter 2 of <span class="citation" data-cites="angrist_pischke_2008">Angrist and Pischke (<a href="#ref-angrist_pischke_2008" role="doc-biblioref">2008</a>)</span> for more information<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See <span class="citation" data-cites="imai_king_stuart_2008">Imai, King, and Stuart (<a href="#ref-imai_king_stuart_2008" role="doc-biblioref">2008</a>)</span> and <span class="citation" data-cites="coppock2019generalizing">Coppock (<a href="#ref-coppock2019generalizing" role="doc-biblioref">2019</a>)</span> for a more detailed review of the issues discussed in this section.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>See <span class="citation" data-cites="imbens_wooldridge_2007">Imbens and Wooldridge (<a href="#ref-imbens_wooldridge_2007" role="doc-biblioref">2007</a>)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>TODO link to an appropriate guide<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>See <a href="https://methods.egap.org/guides/research-questions/late_en.html">10 Things You Need to Know About the Local Average Treatment Effect</a> for more on non-compliance.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Detailed discussion of both ITT and CACE can be found in chapters 5 and 6 of <span class="citation" data-cites="gerber_green_2012">Gerber and Green (<a href="#ref-gerber_green_2012" role="doc-biblioref">2012</a>)</span>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Abadie, Angrist, and Imbens (2002)<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Chernozhukov and Hansen (2005). That is, treatment can have heterogeneous effects but the ordering of potential outcomes is preserved. See Angrist and Pischke Angrist, Joshua, and Jörn-Steffen Pischke. 2008. Mostly Harmless Econometrics: An Empiricist’s Companion. Princeton university press. See Frölich and Melly (2010) for fairly concise discussions of these issues and Abbring and Heckman (Abbring, Jaap H, and James J Heckman. 2007. “Econometric Evaluation of Social Programs, Part III: Distributional Treatment Effects, Dynamic Treatment Effects, Dynamic Discrete Choice, and General Equilibrium Policy Evaluation.” Handbook of Econometrics 6. Elsevier: 5145–5303.) (2007) for a thorough overview.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>See Koenker, Roger, and Kevin Hallock. 2001. “Quantile Regression: An Introduction.” Journal of Economic Perspectives 15 (4): 43–56. for a concise overview of quantile regression<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>For more on the AMCe and conjoint experiments, see <span class="citation" data-cites="bansak2022using">Bansak et al. (<a href="#ref-bansak2022using" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="liu2023multiple">Liu and Shiraito (<a href="#ref-liu2023multiple" role="doc-biblioref">2023</a>)</span><a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>See <span class="citation" data-cites="acharya2018analyzing">Acharya, Blackwell, and Sen (<a href="#ref-acharya2018analyzing" role="doc-biblioref">2018</a>)</span>.<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/methods\.egap\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>